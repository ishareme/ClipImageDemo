{"version":3,"file":"ClipImage.min.js","sources":["../src/utils.js","../src/index.js"],"sourcesContent":["export default {\n    isImageDom: function (img) {\n        return img.tagName.toLowerCase() === 'img';\n    },\n    isCanvasDom: function (canvas) {\n        return canvas.tagName.toLowerCase() === 'canvas';\n    },\n    isVideoDom: function (video) {\n        return video.tagName.toLowerCase() === 'video';\n    },\n\n    isPX: function (str) {\n        return str.trim().endsWith('px');\n    },\n    isPercent: function (str) {\n        return str.trim().endsWith('%');\n    },\n    isCenter: function (str) {\n        return str.trim().toLowerCase() === 'center';\n    },\n    isLeft: function (str) {\n        return str.trim().toLowerCase() === 'left';\n    },\n    isTop: function (str) {\n        return str.trim().toLowerCase() === 'top';\n    },\n    isRight: function (str) {\n        return str.trim().toLowerCase() === 'right';\n    },\n    isBottom: function (str) {\n        return str.trim().toLowerCase() === 'bottom';\n    },\n\n    isPNG(val){\n        return val.trim().toLowerCase() === 'png';\n    },\n    isJPG(val){\n        return val.trim().toLowerCase() === 'jpg' || val.trim().toLowerCase() === 'jpeg';\n    },\n    //数组判断\n    isArray: Array.isArray || function (arr) {\n        return Array.prototype.toString.call(arr) === '[object Array]';\n    },\n    //判断数字\n    isNumber: function (val) {\n        //isFinite 检测是否为无穷大\n        //isNumber(parseInt(a))   // true\n        // 第一种写法\n        return typeof val === 'number' && isFinite(val);\n        //第二种写法\n        // return typeof val === 'number' && !isNaN(val)\n    },\n    //判断字符串\n    isString: function (str) {\n        return typeof str === 'string';\n    },\n    //判断布尔值\n    isBoolean: function (bool) {\n        return typeof bool === 'boolean';\n    },\n    //判断函数\n    isFun: function (fn) {\n        return typeof fn === 'function';\n    },\n    //判断对象\n    isObject: function (obj) {\n        //{},[],null 用typeof检测不出来\n        return Object.prototype.toString.call(obj) === '[object Object]';\n    },\n    //判断undefined\n    isUndefined: function (undefined) {\n        return typeof undefined === 'undefined';\n    },\n    isNull: function (n) {\n        //判断空值用 n === null\n        return n === null;\n    },\n    isNaN: function (val) {\n        return typeof val === 'number' && isNaN(val);\n    },\n    $(ele){\n        if(document.querySelector){\n            return document.querySelector(ele);\n        } else {\n            if (ele.indexOf('#') > -1){\n                return document.getElementById(ele.replace('#',''));\n            } else if (ele.indexOf('.') > -1){\n                return document.getElementsByClassName(ele.replace('.',''))[0];\n            } else {\n                return document.getElementsByTagName(ele)[0];\n            }\n        }\n    },\n    extend(){\n        let options, name, clone, copy, source, copyIsArray,\n            target = arguments[0] || {},\n            i = 1,\n            length = arguments.length,\n            deep = false;\n\n        if (typeof target === 'boolean') {\n            deep = target;\n            target = arguments[i] || {};\n            i++;\n        }\n\n        if (typeof target !== 'object' && type(target) !== 'function') {\n            target = {};\n        }\n\n        if (i === length) {\n            target = this;\n            i--;\n        }\n\n        for (; i < length; i++) {\n            //\n            if ((options = arguments[i]) !== null) {\n                // for in source object\n                for (name in options) {\n\n                    source = target[name];\n                    copy = options[name];\n\n                    if (target == copy) {\n                        continue;\n                    }\n\n                    // deep clone\n                    if (deep && copy && (isPlainObject(copy) || (copyIsArray = Array.isArray(copy)))) {\n                        // if copy is array\n                        if (copyIsArray) {\n                            copyIsArray = false;\n                            // if is not array, set it to array\n                            clone = source && Array.isArray(source) ? source : [];\n                        } else {\n                            // if copy is not a object, set it to object\n                            clone = source && isPlainObject(source) ? source : {};\n                        }\n\n                        target[name] = this.extend(deep, clone, copy);\n                    } else if (copy !== undefined) {\n                        target[name] = copy;\n                    }\n                }\n            }\n        }\n\n        return target;\n    },\n};\n\nfunction type(object) {\n    let class2type = {},\n        type = class2type.toString.call(object),\n        typeString = 'Boolean Number String Function Array Date RegExp Object Error Symbol';\n\n    if (object == null) {\n        return object + '';\n    }\n\n    typeString.split(' ').forEach((type) => {\n        class2type[`[object ${type}]`] = type.toLowerCase();\n    });\n\n    return (\n        typeof object === 'object' ||\n        typeof object === 'function' ?\n            class2type[type] || 'object' :\n            typeof object\n    );\n}\n\nfunction isPlainObject(object) {\n    let proto,\n        ctor,\n        class2type = {},\n        toString = class2type.toString,\n        hasOwn = class2type.hasOwnProperty,\n        fnToString = hasOwn.toString,\n        ObjectFunctionString = fnToString.call(Object);\n\n    if (!object || toString.call(object) !== '[object Object]') return false;\n\n    proto = Object.getPrototypeOf(object);\n\n    if (!proto) return true;\n\n    ctor = hasOwn.call(proto, 'constructor') && proto.constructor;\n\n    return typeof ctor === 'function' && fnToString.call(ctor) === ObjectFunctionString;\n}","import utils from './utils';\n\nfunction ClipImage(...options) {\n    console.log('ImageClip');\n    return new Promise((resolve, reject) => {\n        this.init(options,resolve,reject);\n    });\n}\n\nClipImage.prototype = {\n    init(options,resolve,reject){\n        console.log('options', options);\n        this.defaultConfigOption = {\n            width: 100,\n            height: 100,\n            left: 0, //数字 px, %, center top 等等\n            top: 0,\n            type: 'jpeg',\n            quality: 1, //0-1\n            success(){},\n            error(){},\n        };\n        this.errorObj = {};\n\n        if (utils.isUndefined(options[0]) || (!utils.isString(options[0]) && !utils.isImageDom(options[0]) && !utils.isCanvasDom(options[0]) && !utils.isVideoDom(options[0]))) return new Error('ClipImage第一个参数是url/HTMLImageElement/HTMLVideoElement/HTMLCanvasElement');\n        if (!utils.isObject(options[1])) return new Error('ClipImage第二个参数是对象哦~~');\n\n        this.canvasImageSource = options[0];\n        this.configOptions = utils.extend(true, this.defaultConfigOption, options[1]);\n\n        this.initCanvas(this.canvasImageSource,resolve,reject);\n    },\n    initCanvas(source,resolve,reject){\n        this.resultCanvas = document.createElement('canvas');\n        this.resultCtx = this.resultCanvas.getContext('2d');\n\n        this.resultW = this.getRealVal(this.configOptions.width, 'x');\n        this.resultH = this.getRealVal(this.configOptions.height, 'y');\n        this.sourceX = this.getRealVal(this.configOptions.left, 'x');\n        this.sourceY = this.getRealVal(this.configOptions.top, 'y');\n\n        this.resultCanvas.width = this.resultW;\n        this.resultCanvas.height = this.resultH;\n\n        if (utils.isString(source) || utils.isImageDom(source)){\n            this.sourceImage = new Image();\n            this.sourceImage.setAttribute('crossOrigin', 'anonymous');\n            this.sourceImage.onload = () => {\n                this.clip(resolve);\n            };\n            this.sourceImage.onerror = (error) =>{\n                this.configOptions.error && this.configOptions.error(error);\n                reject(error);\n            };\n            this.sourceImage.src = utils.isImageDom(source) ? source.src : source;\n        }\n        else if (utils.isCanvasDom(source)){\n            this.sourceImage = source;\n            this.clip(resolve);\n        }\n        else if (utils.isVideoDom(source)){\n\n        }\n    },\n    clip(resolve){\n        console.log('source',this.sourceImage);\n\n        this.resultCtx.drawImage(this.sourceImage, this.sourceX, this.sourceY, this.resultW, this.resultH, 0, 0, this.resultW, this.resultH);\n\n        this.resultB64 = this.resultCanvas.toDataURL(`image/${this.getOutType(this.configOptions.type)}`, this.configOptions.quality);\n\n        this.configOptions.success && this.configOptions.success(this.resultB64);\n\n        resolve(this.resultB64);\n    },\n\n    getRealVal(val, direction){\n        if (utils.isNumber(val) || (utils.isString(val) && utils.isPX(val))){\n            return utils.isNumber(val) ? val : parseInt(val.trim().slice(0, -2));\n        }\n        else if (utils.isString(val) && utils.isPercent(val)){\n            return direction === 'x' ? this.sourceImage.width * (parseInt(val.slice(0, -1)) / 100 ) : this.sourceImage.height * (parseInt(val.slice(0, -1)) / 100 );\n        }\n        else if (utils.isString(val) && utils.isCenter(val)){\n            return direction === 'x' ? this.sourceImage.width / 2 : this.sourceImage.height / 2;\n        }\n        else if (utils.isString(val) && (utils.isLeft(val) || utils.isTop(val))){\n            return 0;\n        }\n        else if (utils.isString(val) && (utils.isRight(val) || utils.isBottom(val))){\n            return utils.isRight(val) ? this.sourceImage.width : this.sourceImage.height;\n        }\n        else {\n            this.errorObj.msg = '参数配置错误';\n            this.configOptions.error && this.configOptions.error(this.errorObj);\n            return false;\n        }\n    },\n    getOutType(val){\n        return utils.isJPG(val) ? 'jpeg' : 'png';\n    },\n};\n\nexport default ClipImage;\n"],"names":["type","object","class2type","toString","call","split","forEach","toLowerCase","isPlainObject","proto","ctor","hasOwn","hasOwnProperty","fnToString","ObjectFunctionString","Object","getPrototypeOf","constructor","ClipImage","options","log","Promise","resolve","reject","init","img","tagName","canvas","video","str","trim","endsWith","val","Array","isArray","arr","prototype","isFinite","bool","fn","obj","undefined","n","isNaN","ele","document","querySelector","indexOf","getElementById","replace","getElementsByClassName","getElementsByTagName","name","clone","copy","source","copyIsArray","target","arguments","i","length","deep","this","extend","defaultConfigOption","errorObj","utils","isUndefined","isString","isImageDom","isCanvasDom","isVideoDom","isObject","canvasImageSource","configOptions","initCanvas","Error","resultCanvas","createElement","resultCtx","getContext","resultW","getRealVal","width","resultH","height","sourceX","left","sourceY","top","sourceImage","Image","setAttribute","onload","clip","onerror","error","_this2","src","drawImage","resultB64","toDataURL","getOutType","quality","success","direction","isNumber","isPX","parseInt","slice","isPercent","isCenter","isLeft","isTop","isRight","isBottom","msg","isJPG"],"mappings":"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"}